#!/bin/bash

if [ -z "$1" ]; then
	notify-send "Countdown" "Specify Counter Time!"
	exit
fi

if [ -f /tmp/countdown ]; then
	notify-send "Countdown" "Countdown already running!"
	exit
fi

notify-send -t 1 "Countdown" "Countdown starting!"

date1=$((`date +%s` + $1)); 
while [ "$date1" -ge `date +%s` ]; do 
	if [ ! -z $(pgrep countdown_stop) ]; then
		break;
	fi
	TIME="$(date -u --date @$(($date1 - `date +%s`)) +%H:%M:%S)"
	echo $TIME > /tmp/countdown
	sleep 0.5
done

if [ ! -z $(pgrep countdown_stop) ]; then
	notify-send "Countdown" "Countdown aborted!\nRemaining: $TIME"
else
	notify-send "Countdown" "Countdown reached zero!"
fi

rm /tmp/countdown
