#!/bin/bash

if [ -f /tmp/countdown ]; then
	notify-send "Countdown" "Countdown already running!"
	exit
fi

if [ -z "$1" ]; then
	notify-send "Countdown" "Specify Counter Time!"
	exit
fi


notify-send -t 1 "Countdown" "Countdown starting!"

date1=$((`date +%s` + $1 * 60)); 
while [ "$date1" -ge `date +%s` ]; do 
	if [ ! -z $(pgrep countdown_stop) ]; then
		break;
	fi

	if [ ! -z $(pgrep countdown_pause) ]; then
		pause_time=$((`date +%s`))
		while [ ! -z $(pgrep countdown_pause) ]; do
			sleep 1
			if [ -z $(pgrep countdown_pause) ]; then
				diff=$((`date +%s` - $pause_time))
				date1=$(($date1 + $diff))
			fi
		done
	fi

	TIME="$(date -u --date @$(($date1 - `date +%s`)) +%H:%M:%S)"
	echo $TIME > /tmp/countdown
	sleep 0.5
done

if [ ! -z $(pgrep countdown_stop) ]; then
	notify-send "Countdown" "Countdown aborted!\nRemaining: $TIME"
else
	notify-send "Countdown" "Countdown reached zero!"
fi
