#!/bin/bash

function startBar(){
	MONITOR=$1 TRAY_POS=$2 polybar -c ~/.config/polybar/config.ini bottom &
}

killall -q polybar

# Wait until killed
while pgrep -u $UID -x polybar >/dev/null; do sleep 1; done

if type "xrandr"; then

	POSITION=""

	# If there is a primary, put system tray on it
	PRIMARY=$(xrandr | grep " connected primary" | cut -d " " -f1)
	if [[ ! -z "$PRIMARY" ]]; then
		startBar $PRIMARY right
	else
		POSITION="right"
	fi

	for MONITOR in $(xrandr | grep " connected" | grep -v "primary" | cut -d " " -f1); do
		startBar $MONITOR $POSITION
	done
else
	startBar
fi
